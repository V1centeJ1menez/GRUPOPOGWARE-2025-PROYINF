{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from \"react\";\nimport useSimulacionConfig from \"./useSimulacionConfig\";\nimport { calcularScoringInicial } from \"../utils/scoring\";\nimport { addSimulation, getHistory, deleteFromHistory, setPendingSimulation } from \"../utils/localHistory\";\nexport default function useSimulacionAnon() {\n  _s();\n  const {\n    CONFIG\n  } = useSimulacionConfig();\n  const [monto, setMonto] = useState(5000000);\n  const [plazo, setPlazo] = useState(24);\n  const [ingresoMensual, setIngresoMensual] = useState(null);\n  const [vistaPrevia, setVistaPrevia] = useState(null);\n  const [mostrarAmortizacion, setMostrarAmortizacion] = useState(false);\n  const [historial, setHistorial] = useState([]);\n  const [loadingHistorial, setLoadingHistorial] = useState(false);\n  const [success, setSuccess] = useState(null);\n  useEffect(() => {\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n  const calcularVistaPrevia = useCallback((mEntrada, pEntrada, ingreso = ingresoMensual) => {\n    const m = Number(mEntrada);\n    const p = Number(pEntrada);\n    if (!m || !p || m <= 0 || p <= 0) {\n      setVistaPrevia(null);\n      return;\n    }\n    const {\n      ajuste,\n      score\n    } = calcularScoringInicial({\n      monto: m,\n      plazo: p,\n      ingresoMensual: ingreso !== null && ingreso !== void 0 ? ingreso : undefined\n    });\n    const tasaAnual = Math.max(0.05, Math.min(0.45, CONFIG.TASA_BASE_ANUAL + ajuste));\n    const gastosOp = Math.round(m * CONFIG.GASTOS_OPERACIONALES_PORCENTAJE);\n    const comisionAp = Math.round(m * CONFIG.COMISION_APERTURA);\n    const montoLiq = Math.round(m - gastosOp - comisionAp);\n    const i = tasaAnual / 12;\n    const cuota = Math.round(m * i / (1 - Math.pow(1 + i, -p)));\n    const montoTot = Math.round(cuota * p);\n    const intereses = Math.round(montoTot - m);\n    const cae = parseFloat((tasaAnual + (gastosOp + comisionAp) / m).toFixed(6));\n    const resultado = m >= CONFIG.MONTO_MIN && p >= CONFIG.PLAZO_MIN && p <= CONFIG.PLAZO_MAX ? \"aprobado\" : \"rechazado\";\n    setVistaPrevia({\n      monto: m,\n      plazo: p,\n      tasaBase: tasaAnual,\n      cae,\n      cuotaMensual: cuota,\n      montoTotal: montoTot,\n      montoLiquido: montoLiq,\n      interesesTotales: intereses,\n      gastosOperacionales: gastosOp,\n      comisionApertura: comisionAp,\n      resultado,\n      scoreInicial: score\n    });\n  }, [CONFIG, ingresoMensual]);\n  useEffect(() => {\n    calcularVistaPrevia(monto, plazo);\n  }, [monto, plazo, calcularVistaPrevia]);\n  const cargarHistorialLocal = useCallback((limit = null) => {\n    setLoadingHistorial(true);\n    const items = getHistory(limit);\n    setHistorial(items);\n    setLoadingHistorial(false);\n  }, []);\n  const handleGuardarLocal = useCallback(() => {\n    if (!vistaPrevia) return;\n    const saved = addSimulation(vistaPrevia);\n    setSuccess(\"✅ Simulación guardada localmente\");\n    setTimeout(() => setSuccess(null), 3000);\n    cargarHistorialLocal(4);\n    return saved;\n  }, [vistaPrevia, cargarHistorialLocal]);\n  const handleEliminarLocal = useCallback(id => {\n    deleteFromHistory(id);\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n  const marcarParaContinuarTrasLogin = useCallback(() => {\n    if (!vistaPrevia) return null;\n    const saved = setPendingSimulation(vistaPrevia);\n    return saved;\n  }, [vistaPrevia]);\n  return {\n    CONFIG,\n    monto,\n    setMonto,\n    plazo,\n    setPlazo,\n    ingresoMensual,\n    setIngresoMensual,\n    vistaPrevia,\n    mostrarAmortizacion,\n    setMostrarAmortizacion,\n    historial,\n    loadingHistorial,\n    success,\n    calcularVistaPrevia,\n    handleGuardarLocal,\n    handleEliminarLocal,\n    cargarHistorialLocal,\n    marcarParaContinuarTrasLogin\n  };\n}\n_s(useSimulacionAnon, \"RcTTn5Mz2MRbZcDtmF/Rj9YthGQ=\", false, function () {\n  return [useSimulacionConfig];\n});","map":{"version":3,"names":["useCallback","useEffect","useState","useSimulacionConfig","calcularScoringInicial","addSimulation","getHistory","deleteFromHistory","setPendingSimulation","useSimulacionAnon","_s","CONFIG","monto","setMonto","plazo","setPlazo","ingresoMensual","setIngresoMensual","vistaPrevia","setVistaPrevia","mostrarAmortizacion","setMostrarAmortizacion","historial","setHistorial","loadingHistorial","setLoadingHistorial","success","setSuccess","cargarHistorialLocal","calcularVistaPrevia","mEntrada","pEntrada","ingreso","m","Number","p","ajuste","score","undefined","tasaAnual","Math","max","min","TASA_BASE_ANUAL","gastosOp","round","GASTOS_OPERACIONALES_PORCENTAJE","comisionAp","COMISION_APERTURA","montoLiq","i","cuota","pow","montoTot","intereses","cae","parseFloat","toFixed","resultado","MONTO_MIN","PLAZO_MIN","PLAZO_MAX","tasaBase","cuotaMensual","montoTotal","montoLiquido","interesesTotales","gastosOperacionales","comisionApertura","scoreInicial","limit","items","handleGuardarLocal","saved","setTimeout","handleEliminarLocal","id","marcarParaContinuarTrasLogin"],"sources":["/home/numpi/Documentos/Semestre 6/Anal/GRUPOPOGWARE-2025-PROYINF/creditos-financieros-pern-docker-microservicios/frontend/src/features/simulacion/hooks/useSimulacionAnon.js"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport useSimulacionConfig from \"./useSimulacionConfig\";\nimport { calcularScoringInicial } from \"../utils/scoring\";\nimport { addSimulation, getHistory, deleteFromHistory, setPendingSimulation } from \"../utils/localHistory\";\n\nexport default function useSimulacionAnon() {\n  const { CONFIG } = useSimulacionConfig();\n  const [monto, setMonto] = useState(5000000);\n  const [plazo, setPlazo] = useState(24);\n  const [ingresoMensual, setIngresoMensual] = useState(null);\n\n  const [vistaPrevia, setVistaPrevia] = useState(null);\n  const [mostrarAmortizacion, setMostrarAmortizacion] = useState(false);\n\n  const [historial, setHistorial] = useState([]);\n  const [loadingHistorial, setLoadingHistorial] = useState(false);\n  const [success, setSuccess] = useState(null);\n\n  useEffect(() => {\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n\n  const calcularVistaPrevia = useCallback((mEntrada, pEntrada, ingreso = ingresoMensual) => {\n    const m = Number(mEntrada);\n    const p = Number(pEntrada);\n\n    if (!m || !p || m <= 0 || p <= 0) {\n      setVistaPrevia(null);\n      return;\n    }\n\n    const { ajuste, score } = calcularScoringInicial({ monto: m, plazo: p, ingresoMensual: ingreso ?? undefined });\n    const tasaAnual = Math.max(0.05, Math.min(0.45, CONFIG.TASA_BASE_ANUAL + ajuste));\n\n    const gastosOp = Math.round(m * CONFIG.GASTOS_OPERACIONALES_PORCENTAJE);\n    const comisionAp = Math.round(m * CONFIG.COMISION_APERTURA);\n    const montoLiq = Math.round(m - gastosOp - comisionAp);\n\n    const i = tasaAnual / 12;\n    const cuota = Math.round(m * i / (1 - Math.pow(1 + i, -p)));\n\n    const montoTot = Math.round(cuota * p);\n    const intereses = Math.round(montoTot - m);\n    const cae = parseFloat((tasaAnual + ((gastosOp + comisionAp) / m)).toFixed(6));\n\n    const resultado = m >= CONFIG.MONTO_MIN && p >= CONFIG.PLAZO_MIN && p <= CONFIG.PLAZO_MAX ? \"aprobado\" : \"rechazado\";\n\n    setVistaPrevia({\n      monto: m,\n      plazo: p,\n      tasaBase: tasaAnual,\n      cae,\n      cuotaMensual: cuota,\n      montoTotal: montoTot,\n      montoLiquido: montoLiq,\n      interesesTotales: intereses,\n      gastosOperacionales: gastosOp,\n      comisionApertura: comisionAp,\n      resultado,\n      scoreInicial: score,\n    });\n  }, [CONFIG, ingresoMensual]);\n\n  useEffect(() => {\n    calcularVistaPrevia(monto, plazo);\n  }, [monto, plazo, calcularVistaPrevia]);\n\n  const cargarHistorialLocal = useCallback((limit = null) => {\n    setLoadingHistorial(true);\n    const items = getHistory(limit);\n    setHistorial(items);\n    setLoadingHistorial(false);\n  }, []);\n\n  const handleGuardarLocal = useCallback(() => {\n    if (!vistaPrevia) return;\n    const saved = addSimulation(vistaPrevia);\n    setSuccess(\"✅ Simulación guardada localmente\");\n    setTimeout(() => setSuccess(null), 3000);\n    cargarHistorialLocal(4);\n    return saved;\n  }, [vistaPrevia, cargarHistorialLocal]);\n\n  const handleEliminarLocal = useCallback((id) => {\n    deleteFromHistory(id);\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n\n  const marcarParaContinuarTrasLogin = useCallback(() => {\n    if (!vistaPrevia) return null;\n    const saved = setPendingSimulation(vistaPrevia);\n    return saved;\n  }, [vistaPrevia]);\n\n  return {\n    CONFIG,\n    monto, setMonto,\n    plazo, setPlazo,\n    ingresoMensual, setIngresoMensual,\n    vistaPrevia,\n    mostrarAmortizacion, setMostrarAmortizacion,\n    historial, loadingHistorial,\n    success,\n    calcularVistaPrevia,\n    handleGuardarLocal,\n    handleEliminarLocal,\n    cargarHistorialLocal,\n    marcarParaContinuarTrasLogin,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}