{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { CONFIG as DEFAULT_CONFIG } from \"../constants\";\nimport { obtenerConfiguracion } from \"../services/simulacionApi\";\nimport { calcularScoringInicial } from \"../utils/scoring\";\nimport { addSimulation, getHistory, deleteFromHistory, setPendingSimulation } from \"../utils/localHistory\";\nexport default function useSimulacionAnon() {\n  _s();\n  const [CONFIG, setCONFIG] = useState(DEFAULT_CONFIG);\n  const [monto, setMonto] = useState(5000000);\n  const [plazo, setPlazo] = useState(24);\n  const [ingresoMensual, setIngresoMensual] = useState(null);\n  const [vistaPrevia, setVistaPrevia] = useState(null);\n  const [mostrarAmortizacion, setMostrarAmortizacion] = useState(false);\n  const [historial, setHistorial] = useState([]);\n  const [loadingHistorial, setLoadingHistorial] = useState(false);\n  const [success, setSuccess] = useState(null);\n  useEffect(() => {\n    (async () => {\n      try {\n        const resp = await obtenerConfiguracion();\n        setCONFIG({\n          TASA_BASE_ANUAL: resp.data.tasaBaseAnual,\n          GASTOS_OPERACIONALES_PORCENTAJE: resp.data.gastosOperacionalesPorcentaje,\n          COMISION_APERTURA: resp.data.comisionApertura,\n          MONTO_MIN: resp.data.montoMinimo,\n          MONTO_MAX: resp.data.montoMaximo,\n          PLAZO_MIN: resp.data.plazoMinimo,\n          PLAZO_MAX: resp.data.plazoMaximo\n        });\n      } catch {\n        // fallback a DEFAULT_CONFIG\n      }\n      cargarHistorialLocal(4);\n    })();\n  }, []);\n  const calcularVistaPrevia = useCallback((mEntrada, pEntrada, ingreso = ingresoMensual) => {\n    const m = Number(mEntrada);\n    const p = Number(pEntrada);\n    if (!m || !p || m <= 0 || p <= 0) {\n      setVistaPrevia(null);\n      return;\n    }\n    const {\n      ajuste,\n      score\n    } = calcularScoringInicial({\n      monto: m,\n      plazo: p,\n      ingresoMensual: ingreso !== null && ingreso !== void 0 ? ingreso : undefined\n    });\n    const tasaAnual = Math.max(0.05, Math.min(0.45, CONFIG.TASA_BASE_ANUAL + ajuste));\n    const gastosOp = Math.round(m * CONFIG.GASTOS_OPERACIONALES_PORCENTAJE);\n    const comisionAp = Math.round(m * CONFIG.COMISION_APERTURA);\n    const montoLiq = Math.round(m - gastosOp - comisionAp);\n    const i = tasaAnual / 12;\n    const cuota = Math.round(m * i / (1 - Math.pow(1 + i, -p)));\n    const montoTot = Math.round(cuota * p);\n    const intereses = Math.round(montoTot - m);\n    const cae = parseFloat((tasaAnual + (gastosOp + comisionAp) / m).toFixed(6));\n    const resultado = m >= CONFIG.MONTO_MIN && p >= CONFIG.PLAZO_MIN && p <= CONFIG.PLAZO_MAX ? \"aprobado\" : \"rechazado\";\n    setVistaPrevia({\n      monto: m,\n      plazo: p,\n      tasaBase: tasaAnual,\n      cae,\n      cuotaMensual: cuota,\n      montoTotal: montoTot,\n      montoLiquido: montoLiq,\n      interesesTotales: intereses,\n      gastosOperacionales: gastosOp,\n      comisionApertura: comisionAp,\n      resultado,\n      scoreInicial: score\n    });\n  }, [CONFIG, ingresoMensual]);\n  useEffect(() => {\n    calcularVistaPrevia(monto, plazo);\n  }, [monto, plazo, calcularVistaPrevia]);\n  const cargarHistorialLocal = useCallback((limit = null) => {\n    setLoadingHistorial(true);\n    const items = getHistory(limit);\n    setHistorial(items);\n    setLoadingHistorial(false);\n  }, []);\n  const handleGuardarLocal = useCallback(() => {\n    if (!vistaPrevia) return;\n    const saved = addSimulation(vistaPrevia);\n    setSuccess(\"✅ Simulación guardada localmente\");\n    setTimeout(() => setSuccess(null), 3000);\n    cargarHistorialLocal(4);\n    return saved;\n  }, [vistaPrevia, cargarHistorialLocal]);\n  const handleEliminarLocal = useCallback(id => {\n    deleteFromHistory(id);\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n  const marcarParaContinuarTrasLogin = useCallback(() => {\n    if (!vistaPrevia) return null;\n    const saved = setPendingSimulation(vistaPrevia);\n    return saved;\n  }, [vistaPrevia]);\n  return {\n    CONFIG,\n    monto,\n    setMonto,\n    plazo,\n    setPlazo,\n    ingresoMensual,\n    setIngresoMensual,\n    vistaPrevia,\n    mostrarAmortizacion,\n    setMostrarAmortizacion,\n    historial,\n    loadingHistorial,\n    success,\n    calcularVistaPrevia,\n    handleGuardarLocal,\n    handleEliminarLocal,\n    cargarHistorialLocal,\n    marcarParaContinuarTrasLogin\n  };\n}\n_s(useSimulacionAnon, \"RO3QsefRFRkUUj1ENZO45a7CeRU=\");","map":{"version":3,"names":["useCallback","useEffect","useMemo","useState","CONFIG","DEFAULT_CONFIG","obtenerConfiguracion","calcularScoringInicial","addSimulation","getHistory","deleteFromHistory","setPendingSimulation","useSimulacionAnon","_s","setCONFIG","monto","setMonto","plazo","setPlazo","ingresoMensual","setIngresoMensual","vistaPrevia","setVistaPrevia","mostrarAmortizacion","setMostrarAmortizacion","historial","setHistorial","loadingHistorial","setLoadingHistorial","success","setSuccess","resp","TASA_BASE_ANUAL","data","tasaBaseAnual","GASTOS_OPERACIONALES_PORCENTAJE","gastosOperacionalesPorcentaje","COMISION_APERTURA","comisionApertura","MONTO_MIN","montoMinimo","MONTO_MAX","montoMaximo","PLAZO_MIN","plazoMinimo","PLAZO_MAX","plazoMaximo","cargarHistorialLocal","calcularVistaPrevia","mEntrada","pEntrada","ingreso","m","Number","p","ajuste","score","undefined","tasaAnual","Math","max","min","gastosOp","round","comisionAp","montoLiq","i","cuota","pow","montoTot","intereses","cae","parseFloat","toFixed","resultado","tasaBase","cuotaMensual","montoTotal","montoLiquido","interesesTotales","gastosOperacionales","scoreInicial","limit","items","handleGuardarLocal","saved","setTimeout","handleEliminarLocal","id","marcarParaContinuarTrasLogin"],"sources":["/home/numpi/Documentos/Semestre 6/Anal/GRUPOPOGWARE-2025-PROYINF/creditos-financieros-pern-docker-microservicios/frontend/src/features/simulacion/hooks/useSimulacionAnon.js"],"sourcesContent":["import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { CONFIG as DEFAULT_CONFIG } from \"../constants\";\nimport { obtenerConfiguracion } from \"../services/simulacionApi\";\nimport { calcularScoringInicial } from \"../utils/scoring\";\nimport { addSimulation, getHistory, deleteFromHistory, setPendingSimulation } from \"../utils/localHistory\";\n\nexport default function useSimulacionAnon() {\n  const [CONFIG, setCONFIG] = useState(DEFAULT_CONFIG);\n  const [monto, setMonto] = useState(5000000);\n  const [plazo, setPlazo] = useState(24);\n  const [ingresoMensual, setIngresoMensual] = useState(null);\n\n  const [vistaPrevia, setVistaPrevia] = useState(null);\n  const [mostrarAmortizacion, setMostrarAmortizacion] = useState(false);\n\n  const [historial, setHistorial] = useState([]);\n  const [loadingHistorial, setLoadingHistorial] = useState(false);\n  const [success, setSuccess] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const resp = await obtenerConfiguracion();\n        setCONFIG({\n          TASA_BASE_ANUAL: resp.data.tasaBaseAnual,\n          GASTOS_OPERACIONALES_PORCENTAJE: resp.data.gastosOperacionalesPorcentaje,\n          COMISION_APERTURA: resp.data.comisionApertura,\n          MONTO_MIN: resp.data.montoMinimo,\n          MONTO_MAX: resp.data.montoMaximo,\n          PLAZO_MIN: resp.data.plazoMinimo,\n          PLAZO_MAX: resp.data.plazoMaximo,\n        });\n      } catch {\n        // fallback a DEFAULT_CONFIG\n      }\n      cargarHistorialLocal(4);\n    })();\n  }, []);\n\n  const calcularVistaPrevia = useCallback((mEntrada, pEntrada, ingreso = ingresoMensual) => {\n    const m = Number(mEntrada);\n    const p = Number(pEntrada);\n\n    if (!m || !p || m <= 0 || p <= 0) {\n      setVistaPrevia(null);\n      return;\n    }\n\n    const { ajuste, score } = calcularScoringInicial({ monto: m, plazo: p, ingresoMensual: ingreso ?? undefined });\n    const tasaAnual = Math.max(0.05, Math.min(0.45, CONFIG.TASA_BASE_ANUAL + ajuste));\n\n    const gastosOp = Math.round(m * CONFIG.GASTOS_OPERACIONALES_PORCENTAJE);\n    const comisionAp = Math.round(m * CONFIG.COMISION_APERTURA);\n    const montoLiq = Math.round(m - gastosOp - comisionAp);\n\n    const i = tasaAnual / 12;\n    const cuota = Math.round(m * i / (1 - Math.pow(1 + i, -p)));\n\n    const montoTot = Math.round(cuota * p);\n    const intereses = Math.round(montoTot - m);\n    const cae = parseFloat((tasaAnual + ((gastosOp + comisionAp) / m)).toFixed(6));\n\n    const resultado = m >= CONFIG.MONTO_MIN && p >= CONFIG.PLAZO_MIN && p <= CONFIG.PLAZO_MAX ? \"aprobado\" : \"rechazado\";\n\n    setVistaPrevia({\n      monto: m,\n      plazo: p,\n      tasaBase: tasaAnual,\n      cae,\n      cuotaMensual: cuota,\n      montoTotal: montoTot,\n      montoLiquido: montoLiq,\n      interesesTotales: intereses,\n      gastosOperacionales: gastosOp,\n      comisionApertura: comisionAp,\n      resultado,\n      scoreInicial: score,\n    });\n  }, [CONFIG, ingresoMensual]);\n\n  useEffect(() => {\n    calcularVistaPrevia(monto, plazo);\n  }, [monto, plazo, calcularVistaPrevia]);\n\n  const cargarHistorialLocal = useCallback((limit = null) => {\n    setLoadingHistorial(true);\n    const items = getHistory(limit);\n    setHistorial(items);\n    setLoadingHistorial(false);\n  }, []);\n\n  const handleGuardarLocal = useCallback(() => {\n    if (!vistaPrevia) return;\n    const saved = addSimulation(vistaPrevia);\n    setSuccess(\"✅ Simulación guardada localmente\");\n    setTimeout(() => setSuccess(null), 3000);\n    cargarHistorialLocal(4);\n    return saved;\n  }, [vistaPrevia, cargarHistorialLocal]);\n\n  const handleEliminarLocal = useCallback((id) => {\n    deleteFromHistory(id);\n    cargarHistorialLocal(4);\n  }, [cargarHistorialLocal]);\n\n  const marcarParaContinuarTrasLogin = useCallback(() => {\n    if (!vistaPrevia) return null;\n    const saved = setPendingSimulation(vistaPrevia);\n    return saved;\n  }, [vistaPrevia]);\n\n  return {\n    CONFIG,\n    monto, setMonto,\n    plazo, setPlazo,\n    ingresoMensual, setIngresoMensual,\n    vistaPrevia,\n    mostrarAmortizacion, setMostrarAmortizacion,\n    historial, loadingHistorial,\n    success,\n    calcularVistaPrevia,\n    handleGuardarLocal,\n    handleEliminarLocal,\n    cargarHistorialLocal,\n    marcarParaContinuarTrasLogin,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}