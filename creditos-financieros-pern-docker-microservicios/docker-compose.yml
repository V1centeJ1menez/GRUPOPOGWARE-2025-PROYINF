services:
  # ==========================
  # AUTH SERVICE
  # ==========================
  auth:
    build: ./auth
    env_file:
      - ./auth/.env
    ports:
      - "4001:4000"
    depends_on:
      - db_auth

  db_auth:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: auth_db
    volumes:
      - db_auth_data:/var/lib/postgresql/data
    ports:
      - "5400:5432"

  # ==========================
  # SIMULACION SERVICE
  # ==========================
  simulacion:
    build: ./services/simulacion
    env_file:
      - ./services/simulacion/.env
    ports:
      - "3002:3002"
    depends_on:
      - db_simulacion

  db_simulacion:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: simulacion_db
    volumes:
      - db_simulacion_data:/var/lib/postgresql/data
    ports:
      - "5402:5432"
      
  # ==========================
  # PGADMIN WEB INTERFACE
  # ==========================
  pgadmin:
    image: dpage/pgadmin4:8.12
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@admin.com
      PGADMIN_DEFAULT_PASSWORD: admin
      PGADMIN_CONFIG_SERVER_MODE: "False"
    ports:
      - "5050:80"
    volumes:
      - ./pgadmin/servers.json:/pgadmin4/servers.json:ro
      - pgadmin_data:/var/lib/pgadmin
  


  # ==========================
  # GATEWAY
  # ==========================
  gateway:
    build: ./gateway
    env_file:
      - ./gateway/.env
    ports:
      - "8080:3000"
    depends_on:
      - auth
      - solicitud
      - evaluacion

  # ==========================
  # FRONTEND
  # ==========================
  frontend:
    build: ./frontend
    ports:
      - "5173:3000"
    depends_on:
      - gateway
      - simulacion

  # ==========================
  # SOLICITUD SERVICE
  # ==========================
  solicitud:
    build: ./services/solicitud
    env_file:
      - ./services/solicitud/.env
    ports:
      - "3003:3003"
    depends_on:
      - db_solicitud

  db_solicitud:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: solicitud_db
    volumes:
      - db_solicitud_data:/var/lib/postgresql/data
    ports:
      - "5403:5432"

  # ==========================
  # EVALUACION SERVICE
  # ==========================
  evaluacion:
    build: ./services/evaluacion
    env_file:
      - ./services/evaluacion/.env
    ports:
      - "3004:3004"
    depends_on:
      - db_evaluacion

  db_evaluacion:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: evaluacion_db
    volumes:
      - db_evaluacion_data:/var/lib/postgresql/data
    ports:
      - "5404:5432"

  # ==========================
  # READY MESSAGE
  # ==========================
  ready_message:
    image: alpine:3.19
    depends_on:
      - frontend
    command: >
      sh -c "sleep 4 &&
      echo 'Todos los servicios est√°n levantados correctamente!' &&
      echo '-----------------------------------------------' &&
      echo 'Frontend:   http://localhost:5173' &&
      echo 'Gateway:    http://localhost:8080' &&
      echo 'Auth:       http://localhost:4000' &&
      echo 'pgAdmin:    http://localhost:5050 (admin@admin.com / admin)' &&
      echo '-----------------------------------------------'"

volumes:
  db_auth_data:
  db_simulacion_data:
  pgadmin_data:
  db_solicitud_data:
  db_evaluacion_data:
